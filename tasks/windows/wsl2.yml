---
- name: Ensure Windows Subsystem for Linux is enabled.
  win_optional_feature:
    name:
      - Microsoft-Windows-Subsystem-Linux
      - VirtualMachinePlatform
    state: present
  register: wsl_status

- name: Restart the machine to complete the WSL install.
  ansible.windows.win_reboot:
  when: wsl_status.reboot_required

- name: Ensure Linux kernel update package installed.
  win_chocolatey:
    name: wsl2
    ignore_checksums: true
    state: present
  ignore_errors: true  # Choco isn't behaving as expected...

# 22.04 not released - skip
# - name: Ensure WSL2 with {{ wsl2_distribution }} installed.
#   win_chocolatey:
#     name: "{{ wsl2_distribution }}"
#     ignore_checksums: true
#     state: present
#   when: wsl2_distribution is defined
#   ignore_errors: true  # Choco isn't behaving as expected...
