---
version: "3"

tasks:

  main:
    desc: ðŸ“¦ Main LXC configuration playbooks to provision and configure all LXC's
    dir: provision/ansible
    aliases: ["m"]
    cmds:
      - task: :doppler:generate-ansible-inventory
      - task: provision-lxc
      - "{{.ANSIBLE_PLAYBOOK_CMD}} {{.ANSIBLE_PLAYBOOK_DIR}}/lxc.yml {{.CLI_ARGS}}"

  provision-lxc:
    desc: ðŸ“¦ Provision LXC's
    dir: provision/ansible
    aliases: ["p"]
    cmds:
      - task: :doppler:generate-ansible-inventory
      - "{{.ANSIBLE_PLAYBOOK_CMD}} --tags provision_lxc {{.ANSIBLE_PLAYBOOK_DIR}}/lxc.yml {{.CLI_ARGS}}"

  dev:
    desc: ðŸ“¦ Dev LXC
    dir: provision/ansible
    deps: [provision-lxc]
    aliases: ["d"]
    cmds:
      - task: :doppler:generate-ansible-inventory
      - "{{.ANSIBLE_PLAYBOOK_CMD}} --tags lxc_dev {{.ANSIBLE_PLAYBOOK_DIR}}/lxc.yml {{.CLI_ARGS}}"

  gitlab-runner:
    desc: ðŸ“¦ Make Gitlab Runner LXC. Ensure 'gitlab_runner_token' in doppler is updated with your group runners. Mine is here -> https://gitlab.com/groups/sami-group/-/runners.
    dir: provision/ansible
    deps: [provision-lxc]
    aliases: ["g"]
    cmds:
      - task: :doppler:generate-ansible-inventory
      - "{{.ANSIBLE_PLAYBOOK_CMD}} --tags lxc_gitlab_runner {{.ANSIBLE_PLAYBOOK_DIR}}/lxc.yml {{.CLI_ARGS}}"

  k3s1:
    desc: ðŸ“¦ Make k3s single node cluster
    dir: provision/ansible
    deps: [provision-lxc]
    aliases: ["k"]
    cmds:
      - task: :doppler:generate-ansible-inventory
      - "{{.ANSIBLE_PLAYBOOK_CMD}} --tags lxc_k3s1 {{.ANSIBLE_PLAYBOOK_DIR}}/lxc.yml {{.CLI_ARGS}}"
      # - task: :k3s:main
